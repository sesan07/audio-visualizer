<audio #audioElement [src]="audioService.selectedAudioConfig.src" (ended)="onEnded()"></audio>

<div #visualizerView class="visualizer-view"
     (click)="onVisualizerChange($event, null)">
    <ng-container *ngFor="let visualizer of visualizerService.visualizers">
        <app-visualizer @visualizerEnterLeaveTrigger
                        [boundaryElement]="visualizerView"
                        [config]="visualizer"
                        [showOutline]="visualizer === visualizerService.activeVisualizer"
                        (click)="onVisualizerChange($event, visualizer)">
        </app-visualizer>
    </ng-container>
    <ng-container *ngFor="let emitter of visualizerService.emitters">
        <app-visualizer-emitter @visualizerEnterLeaveTrigger
                        [config]="emitter"
                        (click)="onEmitterChange($event, emitter)">
        </app-visualizer-emitter>
    </ng-container>
</div>

<div class="control-view">
    <div class="card control-group main-controls">
        <div class="media-controls">
            <button class="secondary-media-btn" nz-button nzShape="circle" title="Next" (click)="onPrevSong()">
                <i nz-icon nzType="step-backward"></i>
            </button>
            <button class="primary-media-btn" nz-button nzType="primary" [title]="isPlaying ? 'Pause' : 'Play'" nzShape="circle" (click)="onPlayPause()">
                <i nz-icon [nzType]="isPlaying ? 'pause' : 'caret-right'"></i>
            </button>
            <button class="secondary-media-btn" nz-button nzShape="circle" title="Previous" (click)="onNextSong()">
                <i nz-icon nzType="step-forward"></i>
            </button>
        </div>

        <button nz-button nz-dropdown [nzDropdownMenu]="audioMenu" nzTrigger="click" nzPlacement="bottomRight">
            Current Song: {{getAudioName(audioService.selectedAudioConfig.src)}}
            <i nz-icon nzType="down"></i>
        </button>
        <nz-dropdown-menu #audioMenu="nzDropdownMenu">
            <ul nz-menu nzSelectable>
                <li *ngFor="let option of audioService.audioConfigs" nz-menu-item (click)="audioService.selectedAudioConfig = option">{{getAudioName(option.src)}}</li>
            </ul>
        </nz-dropdown-menu>
    </div>
    <div class="card control-group">
        <nz-button-group>
            <button nz-button (click)="onAddVisualizerClicked()">Add {{selectedAddVisualizer}} Visualizer</button>
            <button nz-button nz-dropdown [nzDropdownMenu]="visualizerMenu"  nzTrigger="click" nzPlacement="bottomRight" title="Select Visualizer">
                <i nz-icon nzType="ellipsis"></i>
            </button>
            <nz-dropdown-menu #visualizerMenu="nzDropdownMenu">
                <ul nz-menu nzSelectable>
                    <li *ngFor="let option of addVisualizerOptions" nz-menu-item (click)="selectedAddVisualizer = option">{{option}}</li>
                </ul>
            </nz-dropdown-menu>
        </nz-button-group>

        <nz-button-group>
            <button nz-button (click)="onAddEmitterClicked()">Add {{selectedAddEmitter}} Emitter</button>
            <button nz-button nz-dropdown [nzDropdownMenu]="emitterMenu"  nzTrigger="click" nzPlacement="bottomRight" title="Select Emitter">
                <i nz-icon nzType="ellipsis"></i>
            </button>
            <nz-dropdown-menu #emitterMenu="nzDropdownMenu">
                <ul nz-menu nzSelectable>
                    <li *ngFor="let option of addEmitterOptions" nz-menu-item (click)="selectedAddEmitter = option">{{option}}</li>
                </ul>
            </nz-dropdown-menu>
        </nz-button-group>

        <ng-container *ngIf="visualizerService.emitters.length > 0">
            <!-- Divider doesn't look right without span -->
            <span>
                <nz-divider nzText="Active Emitters"></nz-divider>
            </span>
            <div class="list">
                <button class="list-item"
                        *ngFor="let emitter of visualizerService.emitters"
                        nz-button
                        [nzType]="visualizerService.activeEmitter === emitter ? 'primary' : 'default'"
                        (click)="onEmitterChange($event, emitter)">
                    {{emitter.name}}
                </button>
            </div>
        </ng-container>
    </div>
    <app-emitter-controller class="card control-group"
                               @controllerEnterLeaveTrigger
                               *ngIf="visualizerService.activeEmitter"
                               [config]="visualizerService.activeEmitter"
                               (remove)="onRemoveEmitter()">
    </app-emitter-controller>
    <app-visualizer-controller class="card control-group"
                               @controllerEnterLeaveTrigger
                               *ngIf="visualizerService.activeVisualizer"
                               [config]="visualizerService.activeVisualizer"
                               (remove)="onRemoveVisualizer()">
    </app-visualizer-controller>
</div>

