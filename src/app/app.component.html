<audio #audioElement [src]="audioService.selectedAudioConfig.src" (ended)="onEnded()"></audio>

<div #visualizerView class="visualizer-view"
     (click)="onVisualizerViewClicked()">
    <app-visualizer class="visualizer"
                    @visualizerEnterLeaveTrigger
                    *ngFor="let visualizer of visualizerService.visualizers"
                    [animateMovement]="false"
                    [boundaryElement]="visualizerView"
                    [config]="visualizer"
                    [showOutline]="visualizer === visualizerService.activeVisualizer"
                    (click)="onVisualizerSelected(visualizer, $event)">
    </app-visualizer>

    <app-visualizer @visualizerEnterLeaveTrigger
                    *ngFor="let visualizer of visualizerService.emittedVisualizers"
                    [animateMovement]="isPlaying"
                    [boundaryElement]="visualizerView"
                    [config]="visualizer">
    </app-visualizer>

    <app-visualizer-emitter class="visualizer-emitter"
                            @visualizerEnterLeaveTrigger
                            *ngFor="let emitter of visualizerService.emitters"
                            [config]="emitter"
                            (click)="onEmitterSelected(emitter, $event)">
    </app-visualizer-emitter>
</div>

<div class="control-view">
    <div class="card">
        <div class="media-controls">
            <button class="secondary-media-btn" nz-button nzShape="circle" title="Next" (click)="onPrevSong()">
                <i nz-icon nzType="step-backward"></i>
            </button>
            <button class="primary-media-btn" nz-button nzType="primary" [title]="isPlaying ? 'Pause' : 'Play'" nzShape="circle" (click)="onPlayPause()">
                <i nz-icon [nzType]="isPlaying ? 'pause' : 'caret-right'"></i>
            </button>
            <button class="secondary-media-btn" nz-button nzShape="circle" title="Previous" (click)="onNextSong()">
                <i nz-icon nzType="step-forward"></i>
            </button>
        </div>

        <span>
            <nz-divider nzText="Options"></nz-divider>
        </span>
        <div class="control-group">
            <app-control name="Song">
                <nz-select [(ngModel)]="audioService.selectedAudioConfig">
                    <nz-option *ngFor="let option of audioService.audioConfigs" [nzValue]="option" [nzLabel]="getAudioName(option.src)"></nz-option>
                </nz-select>
            </app-control>
            <app-control name="Mode">
                <nz-radio-group [(ngModel)]="audioService.mode">
                    <label *ngFor="let option of modeOptions" nz-radio-button [nzValue]="option.value">{{option.name}}</label>
                </nz-radio-group>
            </app-control>
            <app-control name="Decibel Range">
                <!-- TODO: replace spans with number inputs -->
                <div class="slider-wrapper">
                    <span>{{decibelRange[0]}}</span>
                    <nz-slider nzRange [(ngModel)]="decibelRange" [nzMin]="-100" [nzMax]="0" (ngModelChange)="onDecibelChanged()"></nz-slider>
                    <span>{{decibelRange[1]}}</span>
                </div>
            </app-control>
        </div>
    </div>

    <app-controller-wrapper type="visualizer"
                            [configs]="visualizerService.visualizers"
                            [activeConfig]="visualizerService.activeVisualizer"
                            [addOptions]="addVisualizerOptions"
                            (configSelect)="onVisualizerSelected($event)"
                            (add)="onAddVisualizer($event)"
                            (remove)="onRemoveVisualizer($event)" >
    </app-controller-wrapper>

    <app-controller-wrapper type="emitter"
                            [configs]="visualizerService.emitters"
                            [activeConfig]="visualizerService.activeEmitter"
                            [addOptions]="addEmitterOptions"
                            (configSelect)="onEmitterSelected($event)"
                            (add)="onAddEmitter($event)"
                            (remove)="onRemoveEmitter($event)" >
    </app-controller-wrapper>
</div>
